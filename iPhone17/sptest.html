<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>Google Sheets API GIS テスト</title>
<script src="https://accounts.google.com/gsi/client" async defer></script>
</head>
<body>
<h1>Google Sheets API GIS テスト</h1>
<div id="g_id_onload"
     data-client_id="356906835635-q2le5c9jjcugnvsbn7mmghpoh2g2f3cq.apps.googleusercontent.com"
     data-login_uri=""
     data-auto_prompt="false"
     data-callback="handleCredentialResponse">
</div>

<button id="authorize-btn">スプレッドシート読み込み</button>

<script>
const SPREADSHEET_ID = '1N9mC-I7DVubvXPKxyu0yR2M2u2re743u-u8IPAVMwso';
const RANGE = 'iPhone17-overseas-prices!A1:AE19';

// トークンを保持
let accessToken = null;

// 認証ボタン
document.getElementById('authorize-btn').addEventListener('click', async () => {
    if (!accessToken) {
        // OAuth ポップアップを開く
        google.accounts.oauth2.initTokenClient({
            client_id: 'YOUR_CLIENT_ID.apps.googleusercontent.com',
            scope: 'https://www.googleapis.com/auth/spreadsheets.readonly',
            callback: (tokenResponse) => {
                accessToken = tokenResponse.access_token;
                loadSheet();
            }
        }).requestAccessToken();
    } else {
        loadSheet();
    }
});

async function loadSheet() {
    if (!accessToken) {
        alert('アクセストークンがありません');
        return;
    }

    const res = await fetch(`https://sheets.googleapis.com/v4/spreadsheets/${SPREADSHEET_ID}/values/${RANGE}`, {
        headers: {
            'Authorization': `Bearer ${accessToken}`
        }
    });

    if (!res.ok) {
        console.error('取得失敗', await res.text());
        return;
    }

    const data = await res.json();
    console.log('取得データ:', data.values);
    alert('コンソールにデータを出力しました');
}
</script>
</body>
</html>
