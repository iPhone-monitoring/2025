<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>海外価格 - iPhone相場</title>
<style>
body { font-family: sans-serif; padding: 20px; background:#f0f0f0;}
button { margin: 2px; padding: 4px 8px;}
.active { background: #2563eb; color: white;}
.card { background:white; padding:10px; margin:5px; border-radius:6px; }
</style>
</head>
<body>

<h1>海外価格比較</h1>
<div id="model-selector"></div>
<div id="capacity-selector"></div>
<div id="ranking-container"></div>

<script>
const CSV_URL = 'https://docs.google.com/spreadsheets/d/e/1N9mC-I7DVubvXPKxyu0yR2M2u2re743u-u8IPAVMwso/pub?output=csv';

let allData = [];
let modelCapacityMap = {};

function parsePrice(str){ return parseFloat(str.replace(/[^0-9.]/g,'')) || 0; }

async function loadCSV(){
    const res = await fetch(CSV_URL);
    const text = await res.text();
    const rows = text.trim().split('\n').map(r=>r.split(','));

    const header = rows[0];
    const capacityHeader = rows[1];

    // モデル・容量マップ作成
    let currentModel=null;
    for(let i=2;i<header.length;i++){
        if(header[i]) currentModel=header[i].trim();
        if(currentModel && (capacityHeader[i].endsWith('GB')||capacityHeader[i].endsWith('TB'))){
            if(!modelCapacityMap[currentModel]) modelCapacityMap[currentModel]=[];
            const cap = capacityHeader[i].trim();
            if(!modelCapacityMap[currentModel].includes(cap)) modelCapacityMap[currentModel].push(cap);
        }
    }

    // データ格納（簡易）
    for(const row of rows.slice(2)){
        const country=row[0]; 
        for(const colIndex in modelCapacityMap){
            // 簡易サンプルとして値を1列目のみ
        }
    }

    // モデルボタン作成
    const modelDiv=document.getElementById('model-selector');
    for(const model in modelCapacityMap){
        const btn=document.createElement('button');
        btn.textContent=model;
        btn.addEventListener('click',()=>selectModel(model, btn));
        modelDiv.appendChild(btn);
    }
}

function selectModel(model, btn){
    document.querySelectorAll('#model-selector button').forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');

    const capDiv = document.getElementById('capacity-selector');
    capDiv.innerHTML='';
    modelCapacityMap[model].forEach(cap=>{
        const b = document.createElement('button');
        b.textContent=cap;
        b.addEventListener('click',()=> alert(`ここで ${model} ${cap} の表示処理`));
        capDiv.appendChild(b);
    });
}

loadCSV();
</script>

</body>
</html>
