<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>トップ - iPhone相場</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
html, body { min-height: 100vh; margin:0; }
body { font-family: 'Inter','Noto Sans JP',sans-serif; display:flex; flex-direction:column; }
main { flex-grow:1; }
summary::-webkit-details-marker {
    display: none;
}
summary {
    list-style: none;
}
details[open] summary svg {
    transform: rotate(180deg);
}
.sort-btn.active {
    background-color:#2563eb;
    color:white;
    border-color: #2563eb;
    box-shadow:0 4px 6px -1px rgb(0 0 0 / 0.1),0 2px 4px -2px rgb(0 0 0 / 0.1);
}
.scroll-indicator {
    position: relative;
}
.scroll-indicator::after {
    content: '›';
    position: absolute;
    top: 50%;
    right: 0.5rem; /* 8px */
    transform: translateY(-50%);
    font-size: 2.5rem; /* 40px */
    font-weight: 200;
    color: #94a3b8; /* slate-400 */
    pointer-events: none;
    opacity: 0;
    transition: opacity 0.3s ease-in-out;
    animation: bounce-horizontal 1.5s infinite;
}

.scroll-indicator.is-scrollable::after {
    opacity: 1;
}

@keyframes bounce-horizontal {
  0%, 20%, 50%, 80%, 100% {
    transform: translateY(-50%) translateX(0);
  }
  40% {
    transform: translateY(-50%) translateX(5px);
  }
  60% {
    transform: translateY(-50%) translateX(2px);
  }
}

/* Hide the indicator on screens large enough that the table won't scroll */
@media (min-width: 768px) {
    .scroll-indicator::after {
        display: none;
    }
}
</style>
</head>
<body class="bg-slate-50 text-slate-800">

<!-- ヘッダー -->
<header class="bg-white shadow-md sticky top-0 z-10">
    <div class="container mx-auto px-6 py-4 flex justify-between items-center">
        <a href="index.html" class="text-2xl font-bold text-blue-600">iPhone相場</a>
        <nav class="hidden md:flex items-center space-x-6">
            <a href="index.html" class="text-slate-600 hover:text-blue-600 font-semibold">ホーム</a>
            <!-- iPhone 17 ドロップダウン (クリック式) -->
            <div class="relative js-dropdown">
                <button data-dropdown-toggle="iphone17Dropdown" class="text-slate-600 hover:text-blue-600 font-semibold flex items-center">
                    iPhone 17
                    <svg class="w-4 h-4 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                </button>
                <div id="iphone17Dropdown" class="absolute hidden bg-white shadow-lg rounded-md py-2 w-56 z-20 border border-slate-100 top-full mt-2 right-0">
                    <a href="iPhone17/overseas-prices.html" class="block px-4 py-2 text-sm text-slate-700 hover:bg-blue-50 hover:text-blue-600">海外価格</a>
                    <a href="iPhone17/market-graphs.html" class="block px-4 py-2 text-sm text-slate-700 hover:bg-blue-50 hover:text-blue-600">相場グラフ</a>
                    <a href="iPhone17/market-prices-logs.html" class="block px-4 py-2 text-sm text-slate-700 hover:bg-blue-50 hover:text-blue-600">相場ログ</a>
                </div>
            </div>

            <!-- 過去データ ドロップダウン (クリック式) -->
            <div class="relative js-dropdown">
                <button data-dropdown-toggle="pastDataDropdown" class="text-slate-600 hover:text-blue-600 font-semibold flex items-center">
                    過去データ
                     <svg class="w-4 h-4 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                </button>
                <div id="pastDataDropdown" class="absolute hidden bg-white shadow-lg rounded-md py-2 w-56 z-20 border border-slate-100 top-full mt-2 right-0">
                    <a href="past-data/market-graphs.html" class="block px-4 py-2 text-sm text-slate-700 hover:bg-blue-50 hover:text-blue-600">相場グラフ</a>
                    <a href="past-data/market-prices-logs.html" class="block px-4 py-2 text-sm text-slate-700 hover:bg-blue-50 hover:text-blue-600">相場ログ</a>
                </div>
            </div>

                        <a href="inquiry/inquiry.html" class="text-slate-600 hover:text-blue-600 font-semibold">お問い合わせ</a>

        </nav>
        <!-- ハンバーガーメニューボタン -->
        <button id="mobile-menu-button" class="block md:hidden text-slate-600">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7" />
            </svg>
        </button>
    </div>
    <!-- モバイルメニュー -->
    <div id="mobile-menu" class="hidden md:hidden bg-white border-t border-slate-200">
        <a href="index.html" class="block px-6 py-3 text-slate-600 hover:bg-blue-50 font-semibold">ホーム</a>
        <details class="w-full">
            <summary class="px-6 py-3 text-slate-600 hover:bg-blue-50 font-semibold flex justify-between items-center cursor-pointer">
                <span>iPhone 17</span>
                <svg class="w-4 h-4 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
            </summary>
            <div class="bg-slate-50">
                <a href="iPhone17/overseas-prices.html" class="block pl-10 pr-6 py-3 text-sm text-slate-700 hover:bg-blue-100">海外価格</a>
                <a href="iPhone17/market-graphs.html" class="block pl-10 pr-6 py-3 text-sm text-slate-700 hover:bg-blue-100">相場グラフ</a>
                <a href="iPhone17/market-prices-logs.html" class="block pl-10 pr-6 py-3 text-sm text-slate-700 hover:bg-blue-100">相場ログ</a>
            </div>
        </details>
         <details class="w-full">
            <summary class="px-6 py-3 text-slate-600 hover:bg-blue-50 font-semibold flex justify-between items-center cursor-pointer">
                <span>過去データ</span>
                <svg class="w-4 h-4 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
            </summary>
            <div class="bg-slate-50">
               <a href="past-data/market-graphs.html" class="block pl-10 pr-6 py-3 text-sm text-slate-700 hover:bg-blue-100">相場グラフ</a>
               <a href="past-data/market-prices-logs.html" class="block pl-10 pr-6 py-3 text-sm text-slate-700 hover:bg-blue-100">相場ログ</a>
            </div>
        </details>

        <a href="inquiry/inquiry.html" class="block px-6 py-3 text-slate-600 hover:bg-blue-50 font-semibold">お問い合わせ</a>

    </div>
</header>

<main class="container mx-auto px-6 py-8 md:py-12">
    <!-- ローディングスピナー -->
    <div id="loader" class="flex justify-center items-center py-20">
        <div class="w-10 h-10 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"></div>
    </div>

    <!-- メインコンテンツ (最初は非表示) -->
    <div id="main-content" class="hidden">
        
        <!-- サイト概要 -->
        <section class="bg-white p-6 rounded-lg shadow-md md:min-h-[calc(100vh-180px)] flex flex-col justify-center">
            <h2 class="text-2xl font-bold text-slate-800 mb-4 border-b pb-2">iPhone相場について</h2>
            <p class="text-slate-600 mb-6 leading-relaxed">
                iPhone相場は、最新のiPhoneの市場動向を様々な要素で分析するための情報サイトです。<br>
                海外の販売価格や国内での買取価格・過去のデータと比較することで、購入や売却の最適なタイミングを見つける手助けとなることを目指しています。<br>
                このサイトは個人が作成しているもので閲覧専用サイトです。
            </p>
            <div class="grid md:grid-cols-2 gap-6">
                <div class="bg-slate-50 p-4 rounded-md border border-slate-200">
                    <h3 class="font-bold text-lg text-blue-600 mb-2">iPhone 17 情報</h3>
                    <ul class="space-y-3 text-sm text-slate-700">
                        <li class="grid grid-cols-[6rem_1fr] items-start gap-x-2">
                            <strong><a href="iPhone17/overseas-prices.html" class="text-blue-500 hover:underline">海外価格</a></strong>
                            <span>各国の公式販売価格を比較し、最もお得に購入できる国を掲載しています。</span>
                        </li>
                        <li class="grid grid-cols-[6rem_1fr] items-start gap-x-2">
                            <strong><a href="iPhone17/market-graphs.html" class="text-blue-500 hover:underline">相場グラフ</a></strong>
                            <span>最新iPhoneの価格推移を確認できるグラフを掲載しています。</span>
                        </li>
                        <li class="grid grid-cols-[6rem_1fr] items-start gap-x-2">
                            <strong><a href="iPhone17/market-prices-logs.html" class="text-blue-500 hover:underline">相場ログ</a></strong>
                            <span>日々の価格データを時系列で記録した詳細なログを掲載しています。</span>
                        </li>
                    </ul>
                </div>
                <div class="bg-slate-50 p-4 rounded-md border border-slate-200">
                    <h3 class="font-bold text-lg text-blue-600 mb-2">過去データ</h3>
                     <ul class="space-y-3 text-sm text-slate-700">
                        <li class="grid grid-cols-[6rem_1fr] items-start gap-x-2">
                            <strong><a href="past-data/market-graphs.html" class="text-blue-500 hover:underline">相場グラフ</a></strong>
                            <span>過去に販売されたiPhoneの価格推移を確認できるグラフを掲載しています。</span>
                        </li>
                        <li class="grid grid-cols-[6rem_1fr] items-start gap-x-2">
                            <strong><a href="past-data/market-prices-logs.html" class="text-blue-500 hover:underline">相場ログ</a></strong>
                            <span>過去に販売されたiPhoneの価格データを時系列で記録した詳細なログを掲載しています。</span>
                        </li>
                    </ul>
                </div>
                <div class="bg-slate-50 p-4 rounded-md border border-slate-200 md:col-span-2">
                     <h3 class="font-bold text-lg text-blue-600 mb-2">お問い合わせ</h3>
                     <p class="text-sm text-slate-700">サイトに関するご質問やご要望は<a href="inquiry/inquiry.html" class="text-blue-500 hover:underline">お問い合わせフォーム</a>よりお気軽にご連絡ください。</p>
                </div>
            </div>
        </section>

        <div class="border-b border-slate-200 my-12"></div>

        <h1 class="text-3xl font-bold text-slate-800 mb-6">実質ドル円レート比較</h1>

        <div class="bg-white p-4 sm:p-6 rounded-lg shadow-md mb-8">
            <div class="flex flex-col sm:flex-row sm:flex-wrap justify-center items-center gap-4">
                <span class="font-semibold text-slate-600">並び替え</span>
                <div class="grid grid-cols-2 gap-2 w-full max-w-xs sm:w-auto sm:flex">
                    <button class="sort-btn whitespace-nowrap px-3 py-1.5 text-sm font-semibold rounded-md transition-colors bg-slate-100 text-slate-700 hover:bg-slate-200 border w-full sm:w-auto" data-key="id" data-order="asc">昇順</button>
                    <button class="sort-btn whitespace-nowrap px-3 py-1.5 text-sm font-semibold rounded-md transition-colors bg-slate-100 text-slate-700 hover:bg-slate-200 border w-full sm:w-auto" data-key="id" data-order="desc">降順</button>
                    <button class="sort-btn whitespace-nowrap px-3 py-1.5 text-xs sm:text-sm font-semibold rounded-md transition-colors bg-slate-100 text-slate-700 hover:bg-slate-200 border w-full sm:w-auto" data-key="rate" data-order="asc">ドル円レート 昇順</button>
                    <button class="sort-btn whitespace-nowrap px-3 py-1.5 text-xs sm:text-sm font-semibold rounded-md transition-colors bg-slate-100 text-slate-700 hover:bg-slate-200 border w-full sm:w-auto" data-key="rate" data-order="desc">ドル円レート 降順</button>
                </div>
            </div>
        </div>
        
        <div class="scroll-indicator">
            <div id="table-container" class="overflow-x-auto bg-white rounded-lg shadow-md">
                <table class="w-full min-w-[640px] text-sm text-slate-500">
                    <thead class="text-xs text-slate-700 uppercase bg-slate-100">
                        <tr>
                            <th scope="col" class="px-6 py-3 text-left">機種</th>
                            <th scope="col" class="px-6 py-3 text-center">アメリカ価格</th>
                            <th scope="col" class="px-6 py-3 text-center">日本価格</th>
                            <th scope="col" class="px-6 py-3 text-center">実質ドル円レート</th>
                        </tr>
                    </thead>
                    <tbody id="table-body">
                        <!-- Data will be populated by JS -->
                    </tbody>
                </table>
                 <div id="table-placeholder" class="text-center p-8 text-slate-500"></div>
            </div>
        </div>
    </div>
</main>

<!-- フッター -->
<footer class="bg-slate-800 text-white mt-auto">
    <div class="container mx-auto px-6 py-8 text-center">
        <p>&copy; 2025 iPhone相場. All rights reserved.</p>
    </div>
</footer>


<script>
const CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTYONNTc5QlfCluQxJ6p8Lqt_6wECfxf-o-ynkbVz8viX1-UlZAQmgSLBPSEyhk7UwXrCJuarhIr-6z/pub?gid=1112979601&single=true&output=csv';

let tableData = [];
let currentSort = { key: 'id', order: 'asc' };
let minRateValue = null;
let maxRateValue = null;

function setupEventListeners() {
    // Dropdown menu logic
    const dropdownToggles = document.querySelectorAll('[data-dropdown-toggle]');
    dropdownToggles.forEach(toggle => {
        toggle.addEventListener('click', function(event) {
            event.stopPropagation();
            const dropdownId = this.getAttribute('data-dropdown-toggle');
            const dropdownMenu = document.getElementById(dropdownId);
            
            document.querySelectorAll('.js-dropdown [id$="Dropdown"]').forEach(menu => {
                if (menu.id !== dropdownId) {
                    menu.classList.add('hidden');
                }
            });
            dropdownMenu.classList.toggle('hidden');
        });
    });

    window.addEventListener('click', function(event) {
        if (!event.target.closest('.js-dropdown')) {
            document.querySelectorAll('.js-dropdown [id$="Dropdown"]').forEach(menu => {
                menu.classList.add('hidden');
            });
        }
    });

    // Mobile menu logic
    const mobileMenuButton = document.getElementById('mobile-menu-button');
    const mobileMenu = document.getElementById('mobile-menu');
    if (mobileMenuButton && mobileMenu) {
        mobileMenuButton.addEventListener('click', (event) => {
            event.stopPropagation();
            mobileMenu.classList.toggle('hidden');
        });
    }

    const detailsElements = document.querySelectorAll('#mobile-menu details');
    detailsElements.forEach(details => {
        details.addEventListener('toggle', function() {
            if (this.open) {
                detailsElements.forEach(otherDetails => {
                    if (otherDetails !== this && otherDetails.open) {
                        otherDetails.removeAttribute('open');
                    }
                });
            }
        });
    });

    // Sort buttons logic
    const sortButtons = document.querySelectorAll('.sort-btn');
    sortButtons.forEach(button => {
        button.addEventListener('click', () => {
            currentSort.key = button.dataset.key;
            currentSort.order = button.dataset.order;
            sortAndRenderTable();
            updateSortButtons();
        });
    });
}

function updateSortButtons() {
    const sortButtons = document.querySelectorAll('.sort-btn');
    sortButtons.forEach(button => {
        if (button.dataset.key === currentSort.key && button.dataset.order === currentSort.order) {
            button.classList.add('active');
        } else {
            button.classList.remove('active');
        }
    });
}

function checkTableScroll() {
    const tableContainer = document.getElementById('table-container');
    const indicatorWrapper = tableContainer.parentElement;

    if (tableContainer.scrollWidth > tableContainer.clientWidth) {
        indicatorWrapper.classList.add('is-scrollable');
    } else {
        indicatorWrapper.classList.remove('is-scrollable');
    }
}


function renderTable() {
    const tableBody = document.getElementById('table-body');
    const placeholder = document.getElementById('table-placeholder');
    tableBody.innerHTML = '';

    if (tableData.length === 0) {
        placeholder.textContent = '表示するデータがありません。';
        placeholder.style.display = 'block';
        return;
    }
    placeholder.style.display = 'none';

    tableData.forEach(item => {
        const row = document.createElement('tr');
        row.className = 'bg-white border-b hover:bg-slate-50';

        let rateColor = 'text-slate-800'; // Default black
        if (item.rate !== null) {
            if (item.rate === minRateValue) {
                rateColor = 'text-green-600';
            } else if (item.rate === maxRateValue) {
                rateColor = 'text-red-600';
            }
        }

        row.innerHTML = `
            <td class="px-6 py-4 font-medium text-slate-900 whitespace-nowrap">${item.model}</td>
            <td class="px-6 py-4 text-center">${item.us_price ? '$' + item.us_price.toLocaleString() : 'N/A'}</td>
            <td class="px-6 py-4 text-center">${item.jp_price ? '¥' + item.jp_price.toLocaleString() : 'N/A'}</td>
            <td class="px-6 py-4 text-center font-semibold ${rateColor}">
                ${item.rate ? item.rate.toFixed(2) + ' 円' : 'N/A'}
            </td>
        `;
        tableBody.appendChild(row);
    });
    checkTableScroll();
}

function sortAndRenderTable() {
    const { key, order } = currentSort;
    
    tableData.sort((a, b) => {
        if (a[key] === null) return 1;
        if (b[key] === null) return -1;
        
        if (order === 'asc') {
            return a[key] - b[key];
        } else {
            return b[key] - a[key];
        }
    });
    
    renderTable();
}


async function initializeApp() {
    setupEventListeners();
    const placeholder = document.getElementById('table-placeholder');
    const loader = document.getElementById('loader');
    const mainContent = document.getElementById('main-content');

    try {
        const response = await fetch(CSV_URL);
        if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
        const csvText = await response.text();
        
        const rows = csvText.trim().split(/\r?\n/).slice(1); // Skip header row
        
        tableData = rows.map((row, index) => {
            const columns = row.split(',');
            const modelName = columns[0] ? columns[0].trim() : '';
            const capacity = columns[1] ? columns[1].trim() : '';
            const usPrice = parseFloat(columns[2]);
            const jpPrice = parseFloat(columns[3]);
            const rateFromSheet = parseFloat(columns[4]);
            
            return {
                id: index,
                model: `${modelName} ${capacity}`,
                us_price: isNaN(usPrice) ? null : usPrice,
                jp_price: isNaN(jpPrice) ? null : jpPrice,
                rate: isNaN(rateFromSheet) ? null : rateFromSheet
            };
        });
        
        const validRates = tableData.map(item => item.rate).filter(rate => rate !== null);
        if (validRates.length > 0) {
            minRateValue = Math.min(...validRates);
            maxRateValue = Math.max(...validRates);
        }

        sortAndRenderTable();
        updateSortButtons();
        
        loader.style.display = 'none';
        mainContent.classList.remove('hidden');

    } catch (error) {
        console.error('Error fetching or parsing data:', error);
        placeholder.textContent = 'データの読み込みに失敗しました。';
        loader.style.display = 'none';
        mainContent.classList.remove('hidden');
    }
    window.addEventListener('resize', checkTableScroll);
}


document.addEventListener('DOMContentLoaded', initializeApp);
</script>
</body>
</html>




